import{P as u,_ as B,l as F,Q as R,r as c,a as T,o as E,v as U,c as W,d as i,e as d,f as e,F as N,j as O,i as b,t as l,u as x,h as j,w as D,M as Q,p as $,k as z,I as P,E as w,R as M}from"./index-73bd6dec.js";import{u as G,g as H,r as V}from"./cart-ce767c04.js";function J(o){return u({url:"/api/order/settlement",method:"post",data:o})}function K(o){return u({url:"/api/pay/alipay/createOrder",method:"post",data:o})}function X(o){return u({url:"/api/pay/alipay/queryOrder",params:o})}function Y(o){return u({url:"/api/pay/wxpay/createOrder",method:"post",data:o})}function Z(o){return u({url:"/api/pay/wxpay/queryOrder",params:o})}const v=o=>($("data-v-bf222241"),o=o(),z(),o),ee={class:"confirmOrder"},se=v(()=>e("div",{class:"bgColor"},[e("h1",{class:"main-shopcart"},"确认订单")],-1)),te={class:"main"},oe={class:"info"},ae=v(()=>e("div",{class:"head"},"商品信息",-1)),ce={class:"info-main"},le={class:"coursebg"},ne=["src"],re={class:"courseName"},ie={class:"coursePrice"},de={class:"nowprice"},ue={class:"oldprice"},_e={class:"choose"},pe={class:"pay"},ve={class:"choosebg"},he=["onClick"],me={class:"foot"},ye={class:"foot-item"},fe={class:"unique"},ge={class:"dialogPrice"},be={class:"prices"},xe={class:"codeimg"},ke=["src"],Ie=v(()=>e("div",{class:"alert"},"请您及时付款，已便订单尽快处理！",-1)),Ce=v(()=>e("div",{class:"finish"},[e("div",{class:"error"},"支付遇到问题"),e("div",{class:"success"},"我已支付")],-1)),Ne={__name:"settleAccounts",setup(o){const k=F();let{selectList:_}=R(G());const h=c(!1),I=c([]);let m=c(0);const C=c([]);let y=H();const f=c(""),p=c("");let n=c(""),r=T({description:"暂无选择支付方式"});E(()=>{J(y).then(s=>{s.meta.code==200&&(I.value=s.data.courses,m.value=s.data.totalPrice,C.value=s.data.payModes)})});const q=s=>{r.description=s.description,r.code=s.code,s.code=="alipayment"?K({courses:y,payModes:s.code}).then(t=>{console.log(t),f.value=t.data.payurl,p.value=t.data.orderNumber}):Y({courses:y,payModes:s.code}).then(t=>{console.log(t),f.value=t.data.payurl,p.value=t.data.orderNumber})},L=()=>{X({orderNumber:p.value}).then(s=>{console.log(s),s.meta.code=="200"&&(clearInterval(n.value),P("支付成功"),w().then(t=>{M(_.value,t.data.token).then(g=>{V(),_.value=[]})}),k.push("/"))})},S=()=>{Z({orderNumber:p.value}).then(s=>{console.log(s),s.meta.code=="200"&&(clearInterval(n.value),P("支付成功"),w().then(t=>{M(_.value,t.data.token).then(g=>{V(),_.value=[]})}),k.push("/"))})},A=()=>{if(!r.code)return Q("还未选择支付方式");r.code=="alipayment"?n.value=setInterval(L,2e3):n.value=setInterval(S,2e3),h.value=!0};return U(()=>{clearInterval(n.value),n.value=null}),(s,t)=>{const g=W("el-dialog");return i(),d("div",ee,[se,e("div",te,[e("div",oe,[ae,e("div",ce,[(i(!0),d(N,null,O(I.value,a=>(i(),d("div",{class:"courseInfo",key:a.id},[e("div",le,[e("img",{src:a.courseCover,alt:""},null,8,ne)]),e("div",re,l(a.courseName),1),e("div",ie,[e("span",de,"￥"+l(a.discountPrice),1),e("span",ue,"￥"+l(a.salePrice),1)])]))),128))]),e("div",_e,[e("h3",null,[b(" 支付方式 "),e("span",pe,l(x(r).description),1)]),e("div",ve,[(i(!0),d(N,null,O(C.value,a=>(i(),d("span",{key:a.code,onClick:Oe=>q(a)},l(a.description),9,he))),128))])]),e("ul",me,[e("li",ye,[b(" 应付"),e("span",fe,"￥"+l(x(m).toFixed(2)),1)]),e("li",null,[e("button",{class:"btn",onClick:A},"确认订单")])])])]),j(g,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),class:"pay-dialog",width:"500px"},{default:D(()=>[e("div",ge,[b(" 支付："),e("span",be,l(x(m).toFixed(2))+"元",1)]),e("div",xe,[e("img",{src:f.value},null,8,ke)]),Ie,Ce]),_:1},8,["modelValue"])])}}},Me=B(Ne,[["__scopeId","data-v-bf222241"]]);export{Me as default};
